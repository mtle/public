```json
# vi:set ts=2 sw=2 sts=2 et:
# rhel: kea-dhcp4.conf
# mysql lease and hosts dbs + HA standby

# firewall-cmd
# firewall-cmd --get-default-zone
# firewall-cmd --get-active-zones
## Add x96, jaco and saro to trusted zone and allow mysql(3306), kea ha(8000)
# firewall-cmd --zone=trusted --add-service=mysql --permanent
# firewall-cmd --zone=trusted --add-port=8000/tcp --permanent
# firewall-cmd --zone=trusted --add-source=172.xx.yy.23/32 --permanent
# firewall-cmd --zone=trusted --add-source=172.xx.yy.33/32 --permanent
# firewall-cmd --zone=trusted --add-source=172.xx.yy.31/32 --permanent
# firewall-cmd --reload
# firewall-cmd --zone=trusted --list-all
# cat /etc/firewalld/zones/trusted.xml

{
    "Dhcp4": {
        // Set the server tag for the configuration backend.
        "server-tag": "jaco",

        "interfaces-config": {
            "interfaces": [ "adm", "iot", "pub" ],
            "dhcp-socket-type": "raw"
        },
        "config-control": {
            "config-databases": [
                {
                    "type": "mysql",
                    "reconnect-wait-time": 3000, // expressed in ms
                    "max-reconnect-tries": 3,
                    "name": "keadb",
                    "user": "kea",
                    "password": "kea",
                    "host": "172.xx.yy.23",
                    "port": 3306
                }
            ],
            // Controls how often the server polls the database for the
            // configuration updates. The setting below implies that it
            // will take up to approx. 20 seconds for the server to
            // discover and fetch configuration changes.
            "config-fetch-wait-time": 20
        },

        "control-socket": {
            "socket-type": "unix",
            "socket-name": "/run/kea/kea4-ctrl-socket"
        },

        "host-reservation-identifiers": [ "hw-address", "duid", "client-id" ],
        "lease-database": {
            "type": "mysql",
            "user": "kea",
            "password": "changeMe-pw",
            "host": "172.xx.yy.23",
            "port": 3306,
            "name": "keadb",
            "reconnect-wait-time": 3000,
            "max-reconnect-tries": 3,
            "on-fail": "stop-retry-exit",
            "connect-timeout": 3
        },
        "hosts-database": {
            "type": "mysql",
            "user": "kea",
            "password": "changeMe-pw",
            "host": "172.xx.yy.23",
            "port": 3306,
            "name": "keadb",
            "readonly": true
        },

        "expired-leases-processing": {
            "reclaim-timer-wait-time": 10,
            "flush-reclaimed-timer-wait-time": 25,
            "hold-reclaimed-time": 3600,
            "max-reclaim-leases": 100,
            "max-reclaim-time": 250,
            "unwarned-reclaim-cycles": 5
        },

        "valid-lifetime": 86400,
        "calculate-tee-times": true,
        "echo-client-id": false,
        "match-client-id": true,
        "authoritative": true,
        "reservations-global": false,
        "reservations-in-subnet": true,
        "reservations-out-of-pool": true,

        "hooks-libraries": [
            {
                "library": "/usr/lib64/kea/hooks/libdhcp_lease_cmds.so",
                "parameters": { }
            },
            {
                "library": "/usr/lib64/kea/hooks/libdhcp_mysql_cb.so"
            },
            {
                "library": "/usr/lib64/kea/hooks/libdhcp_ha.so",
                "parameters": {
                    "high-availability": [
                        {
                            "this-server-name": "saro",
                            //"trust-anchor": /usr/lib/kea/CA.pem,
                            //"cert-file": /usr/lib/kea/server2_cert.pem,
                            //"key-file": /usr/lib/kea/server2_key.pem,
                            "mode": "hot-standby",
                            "heartbeat-delay": 10000,
                            "max-response-delay": 60000,
                            "max-ack-delay": 5000,
                            "max-unacked-clients": 5,
                            "peers": [
                                {
                                    "name": "saro",
                                    "url": "http://172.xx.yy.33:12418/",
                                    "role": "primary",
                                    "auto-failover": true
                                },
                                {
                                    "name": "jaco",
                                    "url": "http://172.xx.yy.31:12418/",
                                    "role": "standby",
                                    "auto-failover": true
                                }
                            ]
                        }
                    ]
                }
            }
        ],

        "subnet4": [
            {
                "subnet": "172.xx.yy.0/24",
                "interface": "adm",
                "id": 555,
                "pools": [ { "pool": "172.xx.yy.51 - 172.xx.yy.250" } ],
                "option-data": [
                    {
                        "name": "domain-name-servers",
                        "code": 6,
                        "data": "172.xx.yy.31, 172.xx.yy.33, 172.xx.yy.23"
                    },
                    {
                        "name": "routers",
                        "code": 3,
                        "data": "172.xx.yy.5"
                    }
                ]
            },
            {
                "subnet": "172.xx.yy.0/24",
                "interface": "iot",
                "id": 777,
                "pools": [ { "pool": "172.xx.yy.51 - 172.xx.yy.250" } ],
                "option-data": [
                    {
                        "name": "domain-name-servers",
                        "code": 6,
                        "data": "172.xx.yy.31, 172.xx.yy.33, 172.xx.yy.23"
                    },
                    {
                        "name": "routers",
                        "code": 3,
                        "data": "172.xx.yy.5"
                    }
                ]
            },
            {
                "subnet": "172.xx.yy.0/24",
                "interface": "pub",
                "id": 888,
                "pools": [ { "pool": "172.xx.yy.51 - 172.xx.yy.250" } ],
                "option-data": [
                    {
                        "name": "domain-name-servers",
                        "code": 6,
                        "data": "172.xx.yy.31, 172.xx.yy.33, 172.xx.yy.23"
                    },
                    {
                        "name": "routers",
                        "code": 3,
                        "data": "172.xx.yy.5"
                    }
                ]
            }
        ],

        "loggers": [
            {
                "name": "kea-dhcp4",
                "output_options": [
                    {
                        "output": "stdout",
                        "pattern": "%-5p %m\n",
                        "maxsize": 1048576,
                        "maxver": 8
                    }
                ],
                "severity": "INFO",
                "debuglevel":1
            }
        ]
    }
}
```
